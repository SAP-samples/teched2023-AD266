# Exercise 2 - Understand the existing Project setup

In this exercise, we will look at existing files to understand the project structure.

## Exercise 2.1 CDS Maven Plugin

In your application's pom.xml, under the `plugins` section you can see the [`cds-maven-plugin`](https://cap.cloud.sap/docs/java/assets/cds-maven-plugin-site/plugin-info.html) entry.
The interesting part here is the `generate` goal which is responsible for scanning project directories for CDS files and generating Java POJOs for type-safe access to the CDS model.

From your project's source directory, run `mvn clean compile` and you can see the generated classes being added to `srv/src/gen/java`.

## Exercise 2.2 Understanding Service Definitions

Services are one of the core concepts of CAP, they are declared in [CDS](https://cap.cloud.sap/docs/about/#service-definitions-in-cds), and they dispatch events to `Event Handlers`.
Let's examine the `/srv/service.cds` file which defines the services exposed by our application:
   
1. We will examine the `SignupService` and the `GoalService`. 

2. The `SignupService` is a service that just exposes an action. The action takes a `String` session as input.
   ```
   @path: 'SignupService'
   service SignupService {
   action signUp(session: String);
   }
   ```
   The `@path` argument allows you to provide a custom path for the exposed service. 
   The `SignupService` would be available when the application starts up at path: `{application-hostname}/odata/v4/SignupService/`

3. The `GoalService` is a service that exposes an entity `Goal` which is a projection on the `Goal_101` entity exposed by the SuccessFactors Goal Plan API.
   ```
   @path: 'GoalService'
   service GoalService {
     entity Goal as projection on Goal_101 {
     id,
     name as title,
     metric as description,
     done as completion,
     }
   }
   ```
   The `GoalService` would be available when the application starts up at path: `{application-hostname}/odata/v4/GoalService/`

4. You can also see some extensions on the existing entities using `extend`. These are used to add additional fields to the existing entities.

## Exercise 2.3 Understanding EventHandlers

In the previous section, we learnt that `Service`s dispatch events to `Event Handlers`.
Event handlers are the ones that then implement the behaviour of the service.

1. Let's examine the event handler for the `SignupService` in the file `/srv/SignupHandler.java`.

2. The `@ServiceName(SignupService_.CDS_NAME)` annotation at the top of the class specifies the service which the event handler is registered on. 

3. The `@On( event = SignUpContext.CDS_NAME)` annotation on top of the method `signUp(context)` specifies the `Event Phase` at which the method would be called.
   An `Event` can be processed in three phases: `Before`, `On` and `After`. As we are defining the core business logic of the action, we are using the `On` phase.
   What this means is that everytime the `signUp(session)` action is called, this triggers an event and the `signUp(context)` method would be called.

4. `Event Contexts` provide a way to access the parameters and return values. `SignUpContext` is the event context here, which helps us to access the action parameter, additional query parameters and other information of the incoming request.
   It would also be eventually used to set the return value of the action.

5. Note that some imports used in the class like `SignupService_`,`SignUpContext` were all generated by the CDS Maven Plugin.

6. Similarly, for the `GoalService`, the event handler is defined in the file `/srv/GoalHandler.java`.

7. The only difference here is that we define methods for handling Create (`CqnService.EVENT_CREATE`), Read (`CqnService.EVENT_READ`) and Delete (`CqnService.EVENT_DELETE`) events instead using `@On` annotation.
   In the upcoming exercises we will write the business logic for all these methods.

## Exercise 2.4 Run your application locally

1. From the root directory of your project,in your IDE's terminal, run `mvn clean spring-boot:run` to start the application locally.

2. Examine the logs of the application, you should something like this:
```json
INFO 57513 --- [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
INFO 57513 --- [  restartedMain] c.sap.cloud.sdk.demo.ad266.Application   : Started Application in 2.348 seconds (process running for 2.759)
```

4. You can now access the application endpoints `http://localhost:8080/odata/v4/SignupService/$metadata` and `http://localhost:8080/odata/v4/GoalService/$metadata` and see the metadata of the services.

5. The endpoints for fetching goals `http://localhost:8080/odata/v4/GoalService/Goal` and signing up `http://localhost:8080/odata/v4/SignupService/signUp` are also available, but still won't work as we haven't implemented the business logic yet. 

   We will do this in the upcoming exercises. You can stop the application by pressing `Ctrl+C` in the terminal.

## Summary

You've now successfully understood the existing files in your project. Let's now go add some code to get the application working.

Continue to - [Exercise 3 - Add functionality to Event Handlers](../ex3_/README.md)
